<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronoapp</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 1000px;
            width: 100%;
            box-sizing: border-box;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        #app-logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 150px;
            height: auto;
        }
        
        .button-group {
            margin-bottom: 30px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #btn-hidrocortisona {
            background-color: #2196F3;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }
        
        #btn-hidrocortisona:hover {
            background-color: #1976D2;
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }
        
        #btn-prednisona {
            background-color: #FF9800;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }
        
        #btn-prednisona:hover {
            background-color: #F57C00;
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }
        
        #btn-dexametasona {
            background-color: #9C27B0;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
        }
        
        #btn-dexametasona:hover {
            background-color: #7B1FA2;
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        .farmacocinetica-controls {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196F3;
            text-align: left;
        }

        .farmacocinetica-controls h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 8px;
        }

        .control-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #444;
            min-width: 120px;
        }

        .control-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            width: 100px;
        }

        .dosis-total-group {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196F3;
            text-align: center;
        }

        .dosis-total-group label {
            font-weight: 700;
            color: #1976D2;
            font-size: 18px;
            margin-bottom: 10px;
            display: block;
        }

        .dosis-total-group input {
            padding: 12px 16px;
            border: 2px solid #2196F3;
            border-radius: 8px;
            font-size: 18px;
            width: 150px;
            text-align: center;
            font-weight: 600;
            color: #1976D2;
        }

        .dosis-total-group input:focus {
            outline: none;
            border-color: #1565C0;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .horario-dosis-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }

        .horario-dosis-section h4 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }

        .dosis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .dosis-item {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .dosis-item:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
        }

        .dosis-item h5 {
            color: #333;
            margin: 0 0 15px 0;
            text-align: center;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            padding: 8px;
            border-radius: 5px;
            margin: -20px -20px 15px -20px;
        }

        .dosis-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .dosis-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .dosis-field label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        .dosis-field input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
        }

        .dosis-field input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);
        }

        .dosis-mg-display {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid #4CAF50;
            margin-top: 10px;
        }

        .dosis-mg-display span {
            font-weight: 700;
            color: #2e7d32;
            font-size: 16px;
        }

        #btn-generar-grafico {
            background-color: #FF5722;
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
            margin: 20px 0;
        }

        #btn-generar-grafico:hover {
            background-color: #E64A19;
            box-shadow: 0 6px 20px rgba(255, 87, 34, 0.4);
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #FF5722;
        }

        #chart-area {
            max-width: 100%;
            height: 400px;
        }
        
        #recomendacion-texto {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
            margin-top: 20px;
            min-height: 60px;
            text-align: left;
            box-sizing: border-box;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }
        
        .empty-state {
            color: #999;
            font-style: italic;
            text-align: center;
        }
        
        .recomendacion-titulo {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }
        
        .recomendacion-subtitulo {
            font-size: 18px;
            font-weight: 600;
            color: #444;
            margin: 15px 0 10px 0;
        }
        
        .recomendacion-lista {
            margin: 10px 0 15px 0;
            padding-left: 20px;
        }
        
        .recomendacion-lista li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .recomendacion-nota {
            font-style: italic;
            color: #666;
            margin-top: 15px;
            padding: 10px;
            background-color: #e8f5e8;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
        }
        
        .recomendacion-info {
            background-color: #f0f8ff;
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 3px solid #2196F3;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            #recomendacion-texto {
                padding: 20px;
                font-size: 14px;
            }
            
            .recomendacion-titulo {
                font-size: 18px;
            }
            
            .recomendacion-subtitulo {
                font-size: 16px;
            }

            .control-group, .horario-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .control-group label, .horario-group label {
                min-width: auto;
            }

            .dosis-grid {
                grid-template-columns: 1fr;
            }

            .dosis-fields {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CronoApp</h1>
        <img src="logo_chronoapp.jpg" alt="Logo de CronoApp" id="app-logo">
        
        <div class="button-group">
            <button id="btn-hidrocortisona">Hidrocortisona</button>
            <button id="btn-prednisona">Prednisona</button>
            <button id="btn-dexametasona">Dexametasona</button>
        </div>
        
        <div class="farmacocinetica-controls">
            <h3>Parámetros Farmacocinéticos</h3>
            
            <div class="control-group">
                <label for="half-life-input">Vida Media (horas):</label>
                <input type="number" id="half-life-input" step="0.1" min="0.1" placeholder="1.5">
            </div>
            
            <div class="control-group">
                <label for="tmax-input">Tmax (horas):</label>
                <input type="number" id="tmax-input" step="0.1" min="0.1" placeholder="1.0">
            </div>
        </div>

        <div class="dosis-total-group">
            <label for="dosis-total-mg">Dosis Total Diaria (mg):</label>
            <input type="number" id="dosis-total-mg" step="0.1" min="0.1" placeholder="20.0" value="20.0">
        </div>
        
        <div class="horario-dosis-section">
            <h4>Horario de Dosis</h4>
            <div class="dosis-grid">
                <div class="dosis-item">
                    <h5>Dosis 1</h5>
                    <div class="dosis-fields">
                        <div class="dosis-field">
                            <label for="hora-dosis-1">Hora:</label>
                            <input type="time" id="hora-dosis-1" value="08:00">
                        </div>
                        <div class="dosis-field">
                            <label for="porcentaje-dosis-1">%:</label>
                            <input type="number" id="porcentaje-dosis-1" value="70" min="0" max="100" placeholder="70">
                        </div>
                    </div>
                    <div class="dosis-mg-display">
                        Dosis: <span id="dosis-mg-1">14.0 mg</span>
                    </div>
                </div>

                <div class="dosis-item">
                    <h5>Dosis 2</h5>
                    <div class="dosis-fields">
                        <div class="dosis-field">
                            <label for="hora-dosis-2">Hora:</label>
                            <input type="time" id="hora-dosis-2" value="12:00">
                        </div>
                        <div class="dosis-field">
                            <label for="porcentaje-dosis-2">%:</label>
                            <input type="number" id="porcentaje-dosis-2" value="20" min="0" max="100" placeholder="20">
                        </div>
                    </div>
                    <div class="dosis-mg-display">
                        Dosis: <span id="dosis-mg-2">4.0 mg</span>
                    </div>
                </div>

                <div class="dosis-item">
                    <h5>Dosis 3</h5>
                    <div class="dosis-fields">
                        <div class="dosis-field">
                            <label for="hora-dosis-3">Hora:</label>
                            <input type="time" id="hora-dosis-3" value="16:00">
                        </div>
                        <div class="dosis-field">
                            <label for="porcentaje-dosis-3">%:</label>
                            <input type="number" id="porcentaje-dosis-3" value="10" min="0" max="100" placeholder="10">
                        </div>
                    </div>
                    <div class="dosis-mg-display">
                        Dosis: <span id="dosis-mg-3">2.0 mg</span>
                    </div>
                </div>

                <div class="dosis-item">
                    <h5>Dosis 4</h5>
                    <div class="dosis-fields">
                        <div class="dosis-field">
                            <label for="hora-dosis-4">Hora:</label>
                            <input type="time" id="hora-dosis-4" value="20:00">
                        </div>
                        <div class="dosis-field">
                            <label for="porcentaje-dosis-4">%:</label>
                            <input type="number" id="porcentaje-dosis-4" value="0" min="0" max="100" placeholder="0">
                        </div>
                    </div>
                    <div class="dosis-mg-display">
                        Dosis: <span id="dosis-mg-4">0.0 mg</span>
                    </div>
                </div>
            </div>
            
            <button id="btn-generar-grafico">Generar Gráfico</button>
        </div>
        
        <div class="chart-container">
            <canvas id="chart-area"></canvas>
        </div>
        
        <div id="recomendacion-texto" class="empty-state">Selecciona un medicamento para ver la recomendación</div>
    </div>

    <script>
        // Base de datos de recomendaciones organizada en objetos JSON
        const recomendaciones = {
            hidrocortisona: {
                titulo: "Hidrocortisona - Glucocorticoide de acción corta",
                subtitulo: "Vida media: 1,5 horas (1 hora y media)",
                dosificacion: "Dosis dividida en 3-4 tomas diarias",
                esquema: [
                    "Dosis mayor al despertar (6-8 AM): Para imitar el pico natural de cortisol matutino",
                    "Dosis menores durante el día: Para mantener niveles terapéuticos",
                    "Dosis antes de acostarse: Para cubrir el período nocturno"
                ],
                nota: "Esta dosificación respeta el ritmo circadiano natural del cortisol.",
                vidaMedia: 1.5,
                tmax: 1.0,
                dosisTotal: 20.0,
                dosis: [
                    { hora: "08:00", porcentaje: 70 },
                    { hora: "12:00", porcentaje: 20 },
                    { hora: "16:00", porcentaje: 10 },
                    { hora: "20:00", porcentaje: 0 }
                ]
            },
            prednisona: {
                titulo: "Prednisona - Glucocorticoide de acción intermedia",
                subtitulo: "Vida media: 18-36 horas",
                dosificacion: "Dosis única por la mañana (6-8 AM)",
                info: "Tmax (pico de concentración): 1-2 horas post-ingesta",
                justificacion: [
                    "Su efecto prolongado coincide perfectamente con el ritmo circadiano",
                    "El pico de concentración se alcanza rápidamente, proporcionando efecto inmediato",
                    "Su duración de acción cubre todo el día sin necesidad de dosis adicionales"
                ],
                nota: "La administración matutina optimiza la eficacia y minimiza efectos adversos.",
                vidaMedia: 18.0,
                tmax: 1.5,
                dosisTotal: 5.0,
                dosis: [
                    { hora: "08:00", porcentaje: 100 },
                    { hora: "12:00", porcentaje: 0 },
                    { hora: "16:00", porcentaje: 0 },
                    { hora: "20:00", porcentaje: 0 }
                ]
            },
            dexametasona: {
                titulo: "Dexametasona - Glucocorticoide de acción prolongada",
                subtitulo: "Vida media: 36-72 horas",
                dosificacion: "Dosis única por la mañana (6-8 AM)",
                justificacion: [
                    "Su efecto se mantiene durante todo el día gracias a su larga vida media",
                    "Previene la supresión excesiva del eje hipotálamo-hipófisis-adrenal",
                    "Evita el insomnio al no interferir con el patrón natural de sueño"
                ],
                ventajas: [
                    "Sincronización con el ritmo circadiano natural",
                    "Mejor tolerabilidad y menor riesgo de efectos adversos"
                ],
                nota: "La administración matutina es crucial para mantener la homeostasis hormonal.",
                vidaMedia: 54.0,
                tmax: 2.0,
                dosisTotal: 0.5,
                dosis: [
                    { hora: "08:00", porcentaje: 100 },
                    { hora: "12:00", porcentaje: 0 },
                    { hora: "16:00", porcentaje: 0 },
                    { hora: "20:00", porcentaje: 0 }
                ]
            }
        };

        // Variables globales para el gráfico
        let chart = null;

        // Función para calcular y mostrar las dosis en miligramos
        function calcularDosisMg() {
            const dosisTotal = parseFloat(document.getElementById('dosis-total-mg').value) || 0;
            
            for (let i = 1; i <= 4; i++) {
                const porcentaje = parseFloat(document.getElementById(`porcentaje-dosis-${i}`).value) || 0;
                const dosisMg = (porcentaje / 100) * dosisTotal;
                document.getElementById(`dosis-mg-${i}`).textContent = `${dosisMg.toFixed(1)} mg`;
            }
        }

        // Función para crear el HTML de la recomendación de forma estructurada
        function crearRecomendacionHTML(medicamento) {
            const rec = recomendaciones[medicamento];
            let html = '';
            
            // Título principal
            html += `<div class="recomendacion-titulo">${rec.titulo}</div>`;
            
            // Subtítulo con vida media
            html += `<div class="recomendacion-subtitulo">${rec.subtitulo}</div>`;
            
            // Información adicional si existe
            if (rec.info) {
                html += `<div class="recomendacion-info">${rec.info}</div>`;
            }
            
            // Dosificación
            html += `<div class="recomendacion-subtitulo">Dosificación recomendada:</div>`;
            html += `<div>${rec.dosificacion}</div>`;
            
            // Esquema o justificación
            if (rec.esquema) {
                html += `<div class="recomendacion-subtitulo">Esquema de dosificación:</div>`;
                html += '<ul class="recomendacion-lista">';
                rec.esquema.forEach(item => {
                    html += `<li>${item}</li>`;
                });
                html += '</ul>';
            }
            
            if (rec.justificacion) {
                html += `<div class="recomendacion-subtitulo">Justificación farmacocinética:</div>`;
                html += '<ul class="recomendacion-lista">';
                rec.justificacion.forEach(item => {
                    html += `<li>${item}</li>`;
                });
                html += '</ul>';
            }
            
            // Ventajas si existen
            if (rec.ventajas) {
                html += `<div class="recomendacion-subtitulo">Ventajas de la dosificación matutina:</div>`;
                html += '<ul class="recomendacion-lista">';
                rec.ventajas.forEach(item => {
                    html += `<li>${item}</li>`;
                });
                html += '</ul>';
            }
            
            // Nota final
            html += `<div class="recomendacion-nota">${rec.nota}</div>`;
            
            return html;
        }

        // Función para mostrar recomendación y llenar campos
        function mostrarRecomendacion(medicamento) {
            const recomendacionTexto = document.getElementById('recomendacion-texto');
            recomendacionTexto.innerHTML = crearRecomendacionHTML(medicamento);
            recomendacionTexto.classList.remove('empty-state');
            
            // Rellenar automáticamente los campos farmacocinéticos
            const rec = recomendaciones[medicamento];
            document.getElementById('half-life-input').value = rec.vidaMedia;
            document.getElementById('tmax-input').value = rec.tmax;
            document.getElementById('dosis-total-mg').value = rec.dosisTotal;
            
            // Llenar campos de dosis
            rec.dosis.forEach((dosis, index) => {
                document.getElementById(`hora-dosis-${index + 1}`).value = dosis.hora;
                document.getElementById(`porcentaje-dosis-${index + 1}`).value = dosis.porcentaje;
            });
            
            // Calcular y mostrar dosis en miligramos
            calcularDosisMg();
        }

        // Función para generar el gráfico de concentración plasmática
        function generarGrafico() {
            const vidaMedia = parseFloat(document.getElementById('half-life-input').value);
            const tmax = parseFloat(document.getElementById('tmax-input').value);
            const dosisTotal = parseFloat(document.getElementById('dosis-total-mg').value);
            
            if (!vidaMedia || !tmax || !dosisTotal) {
                alert('Por favor, ingresa valores válidos para la vida media, Tmax y dosis total');
                return;
            }
            
            // Obtener datos de las cuatro dosis
            const dosis = [];
            for (let i = 1; i <= 4; i++) {
                const hora = document.getElementById(`hora-dosis-${i}`).value;
                const porcentaje = parseFloat(document.getElementById(`porcentaje-dosis-${i}`).value) || 0;
                if (hora && porcentaje > 0) {
                    dosis.push({
                        hora: hora,
                        porcentaje: porcentaje,
                        mg: (porcentaje / 100) * dosisTotal
                    });
                }
            }
            
            if (dosis.length === 0) {
                alert('Por favor, ingresa al menos una dosis válida');
                return;
            }
            
            // Calcular constante de eliminación (k)
            const k = 0.693 / vidaMedia;
            
            // Generar datos para 24 horas
            const horas = [];
            const concentraciones = [];
            
            // Convertir horas de dosis a minutos desde medianoche
            const dosisMinutos = dosis.map(d => {
                const [h, m] = d.hora.split(':').map(Number);
                return {
                    minutos: h * 60 + m,
                    mg: d.mg
                };
            });
            
            for (let hora = 0; hora <= 24; hora++) {
                const tiempoMinutos = hora * 60;
                horas.push(hora);
                
                let concentracion = 0;
                
                // Calcular concentración para cada dosis
                dosisMinutos.forEach(dosis => {
                    if (tiempoMinutos >= dosis.minutos) {
                        const tiempoDesdeDosis = (tiempoMinutos - dosis.minutos) / 60; // en horas
                        if (tiempoDesdeDosis <= tmax) {
                            // Fase de absorción (hasta Tmax)
                            concentracion += (dosis.mg / dosisTotal) * (tiempoDesdeDosis / tmax);
                        } else {
                            // Fase de eliminación (después de Tmax)
                            const concentracionMaxima = dosis.mg / dosisTotal;
                            concentracion += concentracionMaxima * Math.exp(-k * (tiempoDesdeDosis - tmax));
                        }
                    }
                });
                
                concentraciones.push(concentracion);
            }
            
            // Destruir gráfico anterior si existe
            if (chart) {
                chart.destroy();
            }
            
            // Crear nuevo gráfico
            const ctx = document.getElementById('chart-area').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: horas,
                    datasets: [{
                        label: 'Concentración Plasmática',
                        data: concentraciones,
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Concentración Plasmática en 24 Horas',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Hora del día'
                            },
                            ticks: {
                                stepSize: 2
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Concentración Relativa'
                            },
                            beginAtZero: true,
                            max: Math.max(...concentraciones) * 1.1
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Event listeners para cada botón
        document.getElementById('btn-hidrocortisona').addEventListener('click', () => {
            mostrarRecomendacion('hidrocortisona');
        });
        
        document.getElementById('btn-prednisona').addEventListener('click', () => {
            mostrarRecomendacion('prednisona');
        });
        
        document.getElementById('btn-dexametasona').addEventListener('click', () => {
            mostrarRecomendacion('dexametasona');
        });
        
        // Event listener para el botón de generar gráfico
        document.getElementById('btn-generar-grafico').addEventListener('click', generarGrafico);
        
        // Event listeners para recalcular dosis en mg cuando cambien los valores
        document.getElementById('dosis-total-mg').addEventListener('input', calcularDosisMg);
        
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`porcentaje-dosis-${i}`).addEventListener('input', calcularDosisMg);
        }
        
        // Inicializar cálculo de dosis
        calcularDosisMg();
    </script>
</body>
</html>

